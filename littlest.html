<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Littlest Way Counter</title>
    <meta name="theme-color" content="#6b46c1">
    <style>
        /* Embedded CSS */
        :root {
            --primary: #6b46c1;
            --primary-dark: #553399;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-main: #f9fafb;
            --bg-card: #ffffff;
            --bg-overlay: rgba(0, 0, 0, 0.5);
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --border: #e5e7eb;
            --shadow: rgba(0, 0, 0, 0.1);
            --shadow-lg: rgba(0, 0, 0, 0.15);
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --transition-fast: 150ms ease;
            --transition-base: 250ms ease;
        }

        body.dark-mode {
            --bg-main: #111827;
            --bg-card: #1f2937;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --border: #374151;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color var(--transition-base), color var(--transition-base);
        }

        .screen {
            display: none;
            min-height: 100vh;
        }

        .screen.active {
            display: block;
        }

        /* PIN Screen */
        #pinScreen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        .pin-container {
            text-align: center;
            padding: var(--spacing-xl);
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            box-shadow: 0 20px 25px -5px var(--shadow-lg);
            max-width: 400px;
            width: 90%;
        }

        .pin-container h1 {
            font-size: 2.5rem;
            margin-bottom: var(--spacing-md);
            color: var(--primary);
        }

        .subtitle {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
            font-size: 1rem;
        }

        .pin-input-group {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .pin-input-group input {
            flex: 1;
            padding: var(--spacing-md);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 1.125rem;
            text-align: center;
            letter-spacing: 0.5em;
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .pin-input-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .hint {
            color: var(--text-muted);
            font-size: 0.875rem;
            font-style: italic;
        }

        /* Loading Screen */
        #loadingScreen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: var(--bg-main);
        }

        .loading-content {
            text-align: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--spacing-md);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* App Header */
        .app-header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            padding: var(--spacing-md) var(--spacing-lg);
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 1px 3px var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .app-header h1 {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .header-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .btn-icon {
            background: transparent;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: var(--radius-sm);
            transition: background-color var(--transition-fast);
            color: var(--text-secondary);
        }

        .btn-icon:hover {
            background: var(--border);
        }

        .quote-display {
            text-align: center;
            font-style: italic;
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-top: var(--spacing-sm);
            min-height: 1.5rem;
        }

        /* Main Content */
        .main-content {
            padding: var(--spacing-lg);
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 100px;
        }

        .btn-add {
            width: 100%;
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-lg);
            font-size: 1.125rem;
        }

        .intentions-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .empty-state {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--text-secondary);
        }

        .empty-state p:first-child {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-sm);
        }

        /* Intention Card */
        .intention-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: 0 2px 4px var(--shadow);
            transition: all var(--transition-base);
            border: 1px solid var(--border);
        }

        .intention-card:hover {
            box-shadow: 0 4px 8px var(--shadow);
            transform: translateY(-2px);
        }

        .intention-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-md);
        }

        .intention-info {
            flex: 1;
        }

        .intention-title {
            font-size: 1.25rem;
            margin-bottom: var(--spacing-xs);
            color: var(--text-primary);
        }

        .intention-note {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .intention-counter {
            text-align: center;
            padding: var(--spacing-md) 0;
            margin: var(--spacing-md) 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }

        .counter-today {
            display: block;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
            margin-bottom: var(--spacing-xs);
        }

        .counter-label {
            font-size: 0.875rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .counting-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-sm);
        }

        .btn-count {
            padding: var(--spacing-lg);
            font-size: 1.25rem;
            font-weight: 700;
            border: 2px solid var(--border);
            background: var(--bg-card);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            min-height: 60px;
        }

        .btn-count:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow);
        }

        .btn-count-1 {
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .btn-count-1:hover {
            background: var(--secondary);
            color: white;
        }

        .btn-count-10 {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-count-10:hover {
            background: var(--primary);
            color: white;
        }

        .btn-count-100 {
            border-color: var(--warning);
            color: var(--warning);
        }

        .btn-count-100:hover {
            background: var(--warning);
            color: white;
        }

        /* Footer */
        .app-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            padding: var(--spacing-lg);
            box-shadow: 0 -2px 8px var(--shadow);
        }

        .global-counter {
            text-align: center;
            margin-bottom: var(--spacing-sm);
        }

        .global-counter .counter-label {
            font-size: 0.875rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .global-counter .counter-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: var(--spacing-xs) 0 0;
        }

        .keyboard-hints {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .keyboard-hints span {
            background: var(--border);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-overlay);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-md);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px var(--shadow-lg);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border);
        }

        .modal-header h2 {
            font-size: 1.5rem;
        }

        .modal form {
            padding: var(--spacing-lg);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
        }

        .form-group label {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group textarea {
            padding: var(--spacing-md);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-family: inherit;
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .modal-actions {
            display: flex;
            gap: var(--spacing-sm);
            padding: var(--spacing-lg);
            border-top: 1px solid var(--border);
        }

        .modal-actions .btn {
            flex: 1;
        }

        .btn-secondary {
            background: var(--text-secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--text-primary);
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: var(--spacing-lg);
            left: 50%;
            transform: translateX(-50%);
            z-index: 300;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            pointer-events: none;
        }

        .toast {
            background: var(--text-primary);
            color: white;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 12px var(--shadow-lg);
            font-weight: 500;
            transform: translateY(100px);
            opacity: 0;
            transition: all var(--transition-base);
            max-width: 90vw;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-success {
            background: var(--secondary);
        }

        .toast-error {
            background: var(--danger);
        }

        @media (max-width: 640px) {
            .app-header h1 {
                font-size: 1.25rem;
            }
            .counter-today {
                font-size: 2rem;
            }
            .btn-count {
                font-size: 1rem;
                padding: var(--spacing-md);
                min-height: 50px;
            }
        }
    </style>
</head>
<body>
    <!-- PIN Screen -->
    <div id="pinScreen" class="screen active">
        <div class="pin-container">
            <h1>üïäÔ∏è Littlest Way</h1>
            <p class="subtitle">Enter PIN to continue</p>
            <div class="pin-input-group">
                <input type="password" 
                       id="pinInput" 
                       inputmode="numeric" 
                       maxlength="6" 
                       placeholder="Enter PIN"
                       autocomplete="off">
                <button id="pinSubmit" class="btn btn-primary">Unlock</button>
            </div>
            <p class="hint">PIN: 332211</p>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="screen">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Loading your counter...</p>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="appScreen" class="screen">
        <header class="app-header">
            <div class="header-content">
                <h1>üïäÔ∏è Littlest Way</h1>
                <div class="header-actions">
                    <button id="themeToggle" class="btn-icon" title="Toggle theme">
                        <span class="theme-icon">üåô</span>
                    </button>
                </div>
            </div>
            <div id="quoteDisplay" class="quote-display"></div>
        </header>

        <main class="main-content">
            <button id="addIntentionBtn" class="btn btn-primary btn-add">
                ‚ûï Add New Intention
            </button>

            <div id="intentionsList" class="intentions-list"></div>
        </main>

        <footer class="app-footer">
            <div class="global-counter">
                <p class="counter-label">Global total today</p>
                <p id="globalCount" class="counter-value">0</p>
            </div>
            <div class="keyboard-hints">
                <span>1: +1</span>
                <span>2: +10</span>
                <span>3: +100</span>
                <span>Z: Undo</span>
            </div>
        </footer>

        <div id="toastContainer" class="toast-container"></div>
    </div>

    <!-- Intention Modal -->
    <div id="intentionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add Intention</h2>
                <button class="btn-icon" id="closeModal">‚úï</button>
            </div>
            <form id="intentionForm">
                <div class="form-group">
                    <label for="intentionTitle">Title *</label>
                    <input type="text" 
                           id="intentionTitle" 
                           required 
                           maxlength="100"
                           placeholder="e.g., For my family">
                </div>
                <div class="form-group">
                    <label for="intentionNote">Note (optional)</label>
                    <textarea id="intentionNote" 
                              rows="3" 
                              maxlength="500"
                              placeholder="Additional details..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelModal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyC8h3coWuE2erx7QGQQkykproMDJsg3CUo",
            authDomain: "littlest-7ffe5.firebaseapp.com",
            databaseURL: "https://littlest-7ffe5-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "littlest-7ffe5",
            storageBucket: "littlest-7ffe5.firebasestorage.app",
            messagingSenderId: "97338367295",
            appId: "1:97338367295:web:5e1075caf990514a77078a"
        };

        const CORRECT_PIN = "332211";
        const QUOTES = [
            "Jesus, Mary, I love you. Save souls!",
            "Small acts of love, done with great love.",
            "Every little act of love counts in the eyes of God.",
            "Transform every moment into an offering of love.",
            "The Littlest Way: continuous acts of love for Jesus."
        ];

        let app, auth, db, currentUser;
        let activeIntentions = {};
        let todayCounts = { totals: { sum: 0 }, byIntention: {} };
        let currentEditingIntention = null;

        // PIN Screen Setup
        document.getElementById('pinSubmit').addEventListener('click', handlePINSubmit);
        document.getElementById('pinInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handlePINSubmit();
        });

        async function handlePINSubmit() {
            const pin = document.getElementById('pinInput').value.trim();
            console.log('PIN entered:', pin);
            
            if (pin === CORRECT_PIN) {
                console.log('‚úÖ PIN correct');
                showScreen('loadingScreen');
                await initializeApp();
            } else {
                showToast('Incorrect PIN. Try: 332211', 'error');
                document.getElementById('pinInput').value = '';
            }
        }

        async function initializeApp() {
            try {
                console.log('Loading Firebase...');
                
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                const { getAuth, signInAnonymously, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                const { getDatabase, ref, push, set, update, onValue, increment, get } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
                
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getDatabase(app);
                
                console.log('‚úÖ Firebase initialized');
                
                // Sign in anonymously
                await signInAnonymously(auth);
                console.log('‚úÖ Signed in anonymously');
                
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUser = user;
                        console.log('‚úÖ User UID:', user.uid);
                        setupApp(ref, push, set, update, onValue, increment, get);
                    }
                });
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                showToast('Error loading app: ' + error.message, 'error');
            }
        }

        function setupApp(ref, push, set, update, onValue, increment, get) {
            showScreen('appScreen');
            
            // Setup UI
            setupUIListeners();
            loadIntentions(ref, onValue);
            loadTodayCounts(ref, onValue);
            rotateQuote();
            setInterval(rotateQuote, 30000);
            
            // Make functions global for onclick handlers
            window.addCount = (id, delta) => addCount(id, delta, ref, push, set, update, increment);
            window.editIntention = editIntention;
            window.deleteIntention = (id) => deleteIntention(id, ref, update);
        }

        function loadIntentions(ref, onValue) {
            const intentionsRef = ref(db, `users/${currentUser.uid}/intentions`);
            onValue(intentionsRef, (snapshot) => {
                activeIntentions = {};
                const data = snapshot.val() || {};
                
                for (const [id, intention] of Object.entries(data)) {
                    if (!intention.deleted) {
                        activeIntentions[id] = { ...intention, id };
                    }
                }
                
                renderIntentions();
            });
        }

        function loadTodayCounts(ref, onValue) {
            const today = new Date().toISOString().slice(0, 10);
            const countsRef = ref(db, `users/${currentUser.uid}/counts/${today}`);
            onValue(countsRef, (snapshot) => {
                todayCounts = snapshot.val() || { totals: { sum: 0 }, byIntention: {} };
                updateCounters();
            });
        }

        function renderIntentions() {
            const container = document.getElementById('intentionsList');
            const list = Object.values(activeIntentions);
            
            if (list.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>‚ú® No intentions yet</p>
                        <p>Add your first intention to start counting acts of love</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = list.map(intention => `
                <div class="intention-card">
                    <div class="intention-header">
                        <div class="intention-info">
                            <h3 class="intention-title">${escapeHtml(intention.title)}</h3>
                            ${intention.note ? `<p class="intention-note">${escapeHtml(intention.note)}</p>` : ''}
                        </div>
                        <button class="btn-icon" onclick="window.editIntention('${intention.id}')" title="Edit">‚úèÔ∏è</button>
                    </div>
                    
                    <div class="intention-counter">
                        <span class="counter-today" data-id="${intention.id}">
                            ${todayCounts.byIntention?.[intention.id]?.sum || 0}
                        </span>
                        <span class="counter-label">today</span>
                    </div>
                    
                    <div class="counting-buttons">
                        <button class="btn-count btn-count-1" onclick="window.addCount('${intention.id}', 1)">+1</button>
                        <button class="btn-count btn-count-10" onclick="window.addCount('${intention.id}', 10)">+10</button>
                        <button class="btn-count btn-count-100" onclick="window.addCount('${intention.id}', 100)">+100</button>
                    </div>
                </div>
            `).join('');
        }

        function updateCounters() {
            document.getElementById('globalCount').textContent = todayCounts.totals?.sum || 0;
            
            Object.keys(activeIntentions).forEach(id => {
                const el = document.querySelector(`[data-id="${id}"]`);
                if (el) {
                    el.textContent = todayCounts.byIntention?.[id]?.sum || 0;
                }
            });
        }

        async function addCount(intentionId, delta, ref, push, set, update, increment) {
            const today = new Date().toISOString().slice(0, 10);
            
            try {
                const eventsRef = ref(db, `users/${currentUser.uid}/events`);
                await set(push(eventsRef), {
                    intentionId,
                    delta,
                    ts: Date.now(),
                    date: today
                });
                
                const updates = {};
                updates[`users/${currentUser.uid}/counts/${today}/totals/sum`] = increment(delta);
                updates[`users/${currentUser.uid}/counts/${today}/byIntention/${intentionId}/sum`] = increment(delta);
                await update(ref(db), updates);
                
                showToast(`Added +${delta}`);
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
        }

        function showIntentionModal(intentionId = null) {
            currentEditingIntention = intentionId;
            const modal = document.getElementById('intentionModal');
            const title = document.getElementById('intentionTitle');
            const note = document.getElementById('intentionNote');
            
            if (intentionId) {
                const intention = activeIntentions[intentionId];
                document.getElementById('modalTitle').textContent = 'Edit Intention';
                title.value = intention.title;
                note.value = intention.note || '';
            } else {
                document.getElementById('modalTitle').textContent = 'Add Intention';
                title.value = '';
                note.value = '';
            }
            
            modal.classList.add('active');
            title.focus();
        }

        function editIntention(id) {
            showIntentionModal(id);
        }

        async function deleteIntention(id, ref, update) {
            const intentionRef = ref(db, `users/${currentUser.uid}/intentions/${id}`);
            await update(intentionRef, { deleted: true, deletedAt: Date.now() });
            showToast('Intention removed');
        }

        function setupUIListeners() {
            document.getElementById('addIntentionBtn').addEventListener('click', () => showIntentionModal());
            document.getElementById('closeModal').addEventListener('click', closeModal);
            document.getElementById('cancelModal').addEventListener('click', closeModal);
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            document.getElementById('intentionForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const title = document.getElementById('intentionTitle').value.trim();
                const note = document.getElementById('intentionNote').value.trim();
                
                if (!title) return;
                
                const { ref, push, set, update } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
                
                try {
                    if (currentEditingIntention) {
                        const intentionRef = ref(db, `users/${currentUser.uid}/intentions/${currentEditingIntention}`);
                        await update(intentionRef, { title, note, updatedAt: Date.now() });
                    } else {
                        const intentionsRef = ref(db, `users/${currentUser.uid}/intentions`);
                        await set(push(intentionsRef), {
                            title,
                            note,
                            deleted: false,
                            createdAt: Date.now()
                        });
                    }
                    
                    closeModal();
                    showToast('Intention saved');
                } catch (error) {
                    showToast('Error: ' + error.message, 'error');
                }
            });
            
            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                if (!document.getElementById('appScreen').classList.contains('active')) return;
                
                const list = Object.values(activeIntentions);
                if (list.length === 0) return;
                
                const firstId = list[0].id;
                
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        window.addCount(firstId, 1);
                        break;
                    case '2':
                        e.preventDefault();
                        window.addCount(firstId, 10);
                        break;
                    case '3':
                        e.preventDefault();
                        window.addCount(firstId, 100);
                        break;
                }
            });
        }

        function closeModal() {
            document.getElementById('intentionModal').classList.remove('active');
            currentEditingIntention = null;
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const icon = document.querySelector('.theme-icon');
            icon.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
        }

        function rotateQuote() {
            const display = document.getElementById('quoteDisplay');
            display.textContent = QUOTES[Math.floor(Math.random() * QUOTES.length)];
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => container.removeChild(toast), 300);
            }, 3000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
